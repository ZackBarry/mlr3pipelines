<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Impact Encoding with Random Intercept Models — mlr_pipeops_encodelmer • mlr3pipelines</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Impact Encoding with Random Intercept Models — mlr_pipeops_encodelmer" />
<meta property="og:description" content="Encodes columns of type factor, character and ordered.
PipeOpEncodeLmer() converts factor levels of each factorial column to the
estimated coefficients of a simple random intercept model.
Models are fitted with the glmer function of the lme4 package and are
of the type target ~ 1 + (1 | factor).
If the task is a regression task, the numeric target
variable is used as dependent variable and the factor is used for grouping.
If the task is a classification task, the target variable is used as dependent variable
and the factor is used for grouping.
If the target variable is multiclass, for each level of the multiclass target variable,
binary &quot;one vs. rest&quot; models are fitted.
For training, multiple models can be estimated in a cross-validation scheme
to ensure that the same factor level does not always result in identical
values in the converted numerical feature.
For prediction, a global model (which was fitted on all observations
during training) is used for each factor.
New factor levels are converted to the value of the intercept coefficient
of the global model for prediction.
NAs are ignored by the CPO.
Use the PipeOpTaskPreproc $affect_columns functionality to only encode a subset of
columns, or only encode columns of a certain type." />
<meta property="og:image" content="https://mlr3pipelines.mlr-org.com/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mlr3pipelines</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/comparison_mlr3pipelines_mlr_sklearn.html">Comparison to Other Packages</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mlr-org/mlr3pipelines">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fa fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr3">
    <span class="fa fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Impact Encoding with Random Intercept Models</h1>
    <small class="dont-index">Source: <a href='https://github.com/mlr-org/mlr3pipelines/blob/master/R/PipeOpEncodeLmer.R'><code>R/PipeOpEncodeLmer.R</code></a></small>
    <div class="hidden name"><code>mlr_pipeops_encodelmer.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Encodes columns of type <code>factor</code>, <code>character</code> and <code>ordered</code>.</p>
<p>PipeOpEncodeLmer() converts factor levels of each factorial column to the
estimated coefficients of a simple random intercept model.
Models are fitted with the glmer function of the lme4 package and are
of the type <code>target ~ 1 + (1 | factor)</code>.
If the task is a regression task, the numeric target
variable is used as dependent variable and the factor is used for grouping.
If the task is a classification task, the target variable is used as dependent variable
and the factor is used for grouping.
If the target variable is multiclass, for each level of the multiclass target variable,
binary "one vs. rest" models are fitted.</p>
<p>For training, multiple models can be estimated in a cross-validation scheme
to ensure that the same factor level does not always result in identical
values in the converted numerical feature.
For prediction, a global model (which was fitted on all observations
during training) is used for each factor.
New factor levels are converted to the value of the intercept coefficient
of the global model for prediction.
NAs are ignored by the CPO.</p>
<p>Use the <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code> <code>$affect_columns</code> functionality to only encode a subset of
columns, or only encode columns of a certain type.</p>
    </div>



    <h2 class="hasAnchor" id="format"><a class="anchor" href="#format"></a>Format</h2>

    <p><code>R6Class</code> object inheriting from <code><a href='PipeOpTaskPreprocSimple.html'>PipeOpTaskPreprocSimple</a></code>/<code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>/<code><a href='PipeOp.html'>PipeOp</a></code>.</p>
    <h2 class="hasAnchor" id="construction"><a class="anchor" href="#construction"></a>Construction</h2>

    
<pre>PipeOpEncodeLmer$new(id = "encodelmer", param_vals = list())
</pre>

<p>Identifier of resulting object, default <code>"encodelmer"</code>.</p><ul>
<li><p><code>param_vals</code> :: named <code>list</code><br />
List of hyperparameter settings, overwriting the hyperparameter settings that would
otherwise be set during construction. Default <code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="input-and-output-channels"><a class="anchor" href="#input-and-output-channels"></a>Input and Output Channels</h2>

    

<p>Input and output channels are inherited from <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>.</p>
<p>The output is the input <code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code> with all affected <code>factor</code>, <code>character</code> or
<code>ordered</code> parameters encoded according to the <code>method</code> parameter.</p>
    <h2 class="hasAnchor" id="state"><a class="anchor" href="#state"></a>State</h2>

    

<p>The <code>$state</code> is a named <code>list</code> with the <code>$state</code> elements inherited from <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>, as well as:</p><ul>
<li><p><code>target_levels</code> :: <code>character</code><br />
Levels of the target columns.</p></li>
<li><p><code>control</code> :: a named <code>list</code><br />
List of coefficients learned via <code>glmer</code></p></li>
</ul>

    <h2 class="hasAnchor" id="parameters"><a class="anchor" href="#parameters"></a>Parameters</h2>

    

<ul>
<li><p><code>fast_optim</code>  :: <code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code> <br />
Initialized to <code>TRUE</code>.
If &#8220;fast_optim&#8221; is <code>TRUE</code> (default), a faster (up to 50 percent)
optimizer from the nloptr package is used when fitting the lmer models.
This uses additional stopping criteria which can give suboptimal results.</p></li>
</ul>

    <h2 class="hasAnchor" id="internals"><a class="anchor" href="#internals"></a>Internals</h2>

    

<p>Uses the <code><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>lme4::glmer</a></code>. This is relatively inefficient for features with a large number of levels.</p>
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    

<p>Only methods inherited <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>/<code><a href='PipeOp.html'>PipeOp</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other PipeOps: <code><a href='PipeOpEnsemble.html'>PipeOpEnsemble</a></code>,
  <code><a href='PipeOpImpute.html'>PipeOpImpute</a></code>,
  <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>, <code><a href='PipeOp.html'>PipeOp</a></code>,
  <code><a href='mlr_pipeops_boxcox.html'>mlr_pipeops_boxcox</a></code>,
  <code><a href='mlr_pipeops_branch.html'>mlr_pipeops_branch</a></code>,
  <code><a href='mlr_pipeops_chunk.html'>mlr_pipeops_chunk</a></code>,
  <code><a href='mlr_pipeops_classbalancing.html'>mlr_pipeops_classbalancing</a></code>,
  <code><a href='mlr_pipeops_classifavg.html'>mlr_pipeops_classifavg</a></code>,
  <code><a href='mlr_pipeops_classweights.html'>mlr_pipeops_classweights</a></code>,
  <code><a href='mlr_pipeops_colapply.html'>mlr_pipeops_colapply</a></code>,
  <code><a href='mlr_pipeops_collapsefactors.html'>mlr_pipeops_collapsefactors</a></code>,
  <code><a href='mlr_pipeops_copy.html'>mlr_pipeops_copy</a></code>,
  <code><a href='mlr_pipeops_encodeimpact.html'>mlr_pipeops_encodeimpact</a></code>,
  <code><a href='mlr_pipeops_encode.html'>mlr_pipeops_encode</a></code>,
  <code><a href='mlr_pipeops_featureunion.html'>mlr_pipeops_featureunion</a></code>,
  <code><a href='mlr_pipeops_filter.html'>mlr_pipeops_filter</a></code>,
  <code><a href='mlr_pipeops_fixfactors.html'>mlr_pipeops_fixfactors</a></code>,
  <code><a href='mlr_pipeops_histbin.html'>mlr_pipeops_histbin</a></code>,
  <code><a href='mlr_pipeops_ica.html'>mlr_pipeops_ica</a></code>,
  <code><a href='mlr_pipeops_imputehist.html'>mlr_pipeops_imputehist</a></code>,
  <code><a href='mlr_pipeops_imputemean.html'>mlr_pipeops_imputemean</a></code>,
  <code><a href='mlr_pipeops_imputemedian.html'>mlr_pipeops_imputemedian</a></code>,
  <code><a href='mlr_pipeops_imputenewlvl.html'>mlr_pipeops_imputenewlvl</a></code>,
  <code><a href='mlr_pipeops_imputesample.html'>mlr_pipeops_imputesample</a></code>,
  <code><a href='mlr_pipeops_kernelpca.html'>mlr_pipeops_kernelpca</a></code>,
  <code><a href='mlr_pipeops_learner.html'>mlr_pipeops_learner</a></code>,
  <code><a href='mlr_pipeops_missind.html'>mlr_pipeops_missind</a></code>,
  <code><a href='mlr_pipeops_modelmatrix.html'>mlr_pipeops_modelmatrix</a></code>,
  <code><a href='mlr_pipeops_mutate.html'>mlr_pipeops_mutate</a></code>,
  <code><a href='mlr_pipeops_nop.html'>mlr_pipeops_nop</a></code>,
  <code><a href='mlr_pipeops_pca.html'>mlr_pipeops_pca</a></code>,
  <code><a href='mlr_pipeops_quantilebin.html'>mlr_pipeops_quantilebin</a></code>,
  <code><a href='mlr_pipeops_regravg.html'>mlr_pipeops_regravg</a></code>,
  <code><a href='mlr_pipeops_removeconstants.html'>mlr_pipeops_removeconstants</a></code>,
  <code><a href='mlr_pipeops_scalemaxabs.html'>mlr_pipeops_scalemaxabs</a></code>,
  <code><a href='mlr_pipeops_scalerange.html'>mlr_pipeops_scalerange</a></code>,
  <code><a href='mlr_pipeops_scale.html'>mlr_pipeops_scale</a></code>,
  <code><a href='mlr_pipeops_select.html'>mlr_pipeops_select</a></code>,
  <code><a href='mlr_pipeops_smote.html'>mlr_pipeops_smote</a></code>,
  <code><a href='mlr_pipeops_spatialsign.html'>mlr_pipeops_spatialsign</a></code>,
  <code><a href='mlr_pipeops_subsample.html'>mlr_pipeops_subsample</a></code>,
  <code><a href='mlr_pipeops_unbranch.html'>mlr_pipeops_unbranch</a></code>,
  <code><a href='mlr_pipeops_yeojohnson.html'>mlr_pipeops_yeojohnson</a></code>,
  <code><a href='mlr_pipeops.html'>mlr_pipeops</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"mlr3"</span>)
<span class='no'>poe</span> <span class='kw'>=</span> <span class='fu'><a href='po.html'>po</a></span>(<span class='st'>"encodelmer"</span>)

<span class='no'>task</span> <span class='kw'>=</span> <span class='no'>TaskClassif</span>$<span class='fu'>new</span>(<span class='st'>"task"</span>,
  <span class='kw pkg'>data.table</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/data.table/man/data.table.html'>data.table</a></span>(
    <span class='kw'>x</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"a"</span>, <span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"b"</span>),
    <span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"b"</span>, <span class='st'>"b"</span>)),
  <span class='st'>"x"</span>)</div><div class='output co'>#&gt; <span class='error'>Error: Target column 'x' must be a factor</span></div><div class='input'>
<span class='no'>poe</span>$<span class='fu'>train</span>(<span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>task</span>))<span class='kw'>[[</span><span class='fl'>1</span>]]$<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>()</div><div class='output co'>#&gt; <span class='error'>Error in vapply(.x, .f, FUN.VALUE = .value, USE.NAMES = FALSE, ...): object 'task' not found</span></div><div class='input'>
<span class='no'>poe</span>$<span class='no'>state</span></div><div class='output co'>#&gt; NULL</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#format">Format</a></li>
      <li><a href="#construction">Construction</a></li>
      <li><a href="#input-and-output-channels">Input and Output Channels</a></li>
      <li><a href="#state">State</a></li>
      <li><a href="#parameters">Parameters</a></li>
      <li><a href="#internals">Internals</a></li>
      <li><a href="#methods">Methods</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Martin Binder, Florian Pfisterer, Bernd Bischl, Michel Lang, Susanne Dandl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


